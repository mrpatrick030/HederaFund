# HederaFund Documentation [Web App](https://hederafund.vercel.app) / [Demo Video]()
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmQaGcAFXme1oJBiJ6Pusq1VRSNJZpGCJWvgpkCoakTvVy)
HederaFund is a next-generation DeFi protocol transforming peer-to-peer (P2P) lending and borrowing through a secure, collateral-backed dApp. Designed to overcome the inefficiencies of traditional finance, HederaFund offers users a faster, more transparent, and more accessible lending experience.

Powered by the Hedera test network, HederaFund brings together robust smart contracts, seamless integrations, and a highly intuitive front-end interface. Users enjoy complete control over their assets and data, secured through wallet or email login â€” ensuring privacy and security at every step.

With the HederaFund dashboard, accessing the platform's full suite of features is effortless. Unlike traditional financial systems that involve lengthy approvals, high fees, and intermediaries, HederaFund provides:
* Instant access to lending and borrowing markets without the need for banks or credit checks
* Greater transparency through blockchain technology, ensuring fair and tamper-proof transactions
* Lower fees and better rates thanks to the low gas fees on Hedera network and the elimination of middlemen
* 24/7 global accessibility â€” no waiting for business hours or paperwork
* Enhanced security and user ownership of funds

## Benefits for Lenders on HederaFund:

### Attractive Returns:
Lenders earn interest on the funds they lend, based on the agreed loan terms â€” offering potentially higher yields compared to traditional savings accounts or investments.

### Collateral-Backed Security:
Every loan is backed by collateral. If a borrower fails to repay, the lender can claim the collateral, reducing the risk of loss.

### Decentralized, Trustless Transactions:
Lenders do not need to trust the borrower personally â€” smart contracts automatically enforce the loan terms and collateral handling.

### Full Control Over Funds:
Lenders choose which loans to fund based on the borrower's terms, amount, interest rate, and duration. They stay fully in control of where and how they allocate their capital.

### Transparency:
All loan details, collateral, and borrower activities are recorded transparently on-chain, giving lenders a clear view before making decisions.

### Private and Secure Communication:
Lenders can communicate directly with borrowers through HederaFundâ€™s decentralized chat while maintaining full privacy.

### Participation in a Growing DeFi Ecosystem:
As HederaFund grows and adds more supported tokens and features, lenders benefit from a wider range of investment opportunities.

## Benefits for Borrowers on HederaFund:

### Access to Flexible Loans:
Borrowers can quickly access loans by providing collateral, without needing to go through lengthy credit checks like traditional banks require.

### Decentralized and Permissionless:
Anyone can borrow without middlemen, paperwork, or restrictions, as long as they meet the collateral requirements.

### Fast Funding:
Borrowers can receive funding almost instantly once a lender accepts their loan request, speeding up financial access.

### Privacy and Security:
Borrowers maintain control over their wallets and assets, with no need to expose personal information.

### Clear, Agreed Terms:
Loan amount, interest rate, duration, and collateral are all transparent and set before the loan starts â€” no hidden fees or surprises.

### Ownership of Collateral:
If no lender funds the loan before expiry, the borrower can reclaim their collateral easily and without penalties.

### Decentralized Communication:
Borrowers can chat securely and privately with potential lenders to discuss loan terms if needed.

### Opportunity for Building Trust:
Frequent successful repayments can help borrowers build a reputation within the HederaFund ecosystem, potentially making it easier to get better loan terms in the future.
HederaFund delivers a lending experience that not only matches but exceeds the capabilities of traditional finance, empowering users with true financial freedom.

## Features of HederaFund
The platform features a powerful combination of smart contracts and front-end technologies, delivering a full suite of tools including a P2P lending and borrowing dApp, a Swap, an integrated dashboard, and secure wallet or email login (powered by Web3Modal and Ethers.js). It also offers a decentralized chat within the lending dApp, comprehensive documentation, and reliable file storage through Filebase.
Additional features like search functionalities, pagination, a wide library of Flaticons, and an intuitive, responsive design ensure a slick and seamless user experience across devices.

## Technologies and Tools used
### Smart Contracts
Solidity, HardHat, Remix, OpenZeppelin

### Web3 Integrations
Web3Modal, Ethers.js, Hedera Testnet and Explorer

### Frontend
 Next.js, Tailwind CSS, JavaScript

### Backend
Node.js, PostgreSQL

### Oracles
Chainlink oracles

### APIs and Services
TradingView Live API, Filebase Storage, React Chart.js

## The HederaFund User Flow

### Connect Wallet
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmdPf1mnRwZc18nDrtWreNe76krwVuLvdnxyBHp3dfiiei)
To get started, visit our [Web App](https://hederafund.vercel.app).

#### On Desktop:
Click the "Connect Wallet" button at the top right corner of the screen. You can log in either using your wallet or your email.
If you don't have a wallet installed yet, the WalletConnect window provides direct links to download a wallet compatible with your browser (Brave, Google Chrome, Opera, or Yandex browsers are supported).

#### On Mobile:
Download an EVM-compatible wallet (such as MetaMask or Trust Wallet) and use its built-in browser to access HederaFund. Then, click "Connect Wallet" at the top right.

After initiating the connection, ensure you switch the network to the Hedera Test Network via the wallet connect interface.
Once connected, your dashboard display will update â€” typically showing your Hedera HBAR token balance along with a portion of your wallet address.

### Get testnet Hedera HBAR for gas fees payments
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmUXbi6jakjtUjDvxcZPCAMhbru2cWy2vviNwMWERVKFA4)
Since HederaFund is currently deployed on the Hedera network's testnet, you will need testnet HBAR to cover gas fees during transactions.
You can easily obtain testnet HBAR through the [Hedera testnet](https://portal.hedera.com/faucet).

### Web app homepage
The homepage of the HederaFund web app is the first page youâ€™ll see when you visit the platform. It serves as the gateway to the HederaFund dashboard and features the Connect Wallet button, along with important resources such as platform information and documentation.

 ### The HederaFund Dashboard
This is the core functional area of HederaFund, bringing together the platformâ€™s most essential features â€” including user balances, key metrics, the P2P lending and borrowing dApp and Swap.

### User's Balances
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmVbCZ3cwWUhVk4cRDCZrifUwVLtTWXKSQ52d1BZyLJGpR)
This section of the dashboard shows all the balances of a user after logging in. It displays the following info for a user: HDF balance, HDF price, HBAR balance, number of loans you created, number of loans you funded.

### Metrics
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmbMouw1PZSYqApPDHucXXqsz79c3KU7guNHjRugHQDevG)
The metrics section shows live updates to HederaFund including the following: HDF Total Supply, HDF Price, Protocol Blockchain, Total number of Loans, Max Loan Amount, Min Loan Amount, contract addresses of all contracts used by the protocol and Live HBAR market chart.


## P2P Lend/Borrow dApp
HederaFund enables users to participate in unique P2P lending and borrowing activities involving supported tokens. To initiate the process, a borrower creates a loan request using the "Approve/Create Loan" buttons in the Borrow section. A lender can then fund the loan by using the "Fund Loan" button in the Lend section.
Each loan on HederaFund is defined by a loan amount, an interest rate, an expiry date, and collateral. The borrower's collateral is securely locked by the system until the loan's expiry. If no lender funds the loan before the expiry, the borrower can reclaim their collateral using the "Withdraw Collateral" button in the Lend section. Borrowers who successfully receive funding can withdraw the borrowed tokens using the "Withdraw Loan" button.
If a borrower fails to repay the loan by the expiry date, the lender has the right to claim the posted collateral through the "Claim Collateral" button. Lenders are rewarded generously based on the agreed terms of the loan, with additional security provided by HederaFundâ€™s advanced security algorithms.
When borrowing through HederaFund, users must present sufficient collateral and repay the borrowed amount with interest using the "Repay Loan" button to fulfill their obligations.
For a better user experience, the dApp integrates features like a "View All Available Loans" section and a "View Your Loans" section, along with search functionality and pagination to easily navigate between loans. A decentralized chat is also available, allowing lenders and borrowers to communicate privately and efficiently.
New supported tokens and collateral options will continue to be added to the platform over time, ensuring HederaFund remains dynamic and versatile.

### Borrowing
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmRP8VoPshRvfsmWdXg4s8vosi2k71v39anXEm6UhoVifE)
To borrow, follow the steps below (Your wallet will popup to sign the transactions):
* Fill the details above setting the duration, amount of HBAR to borrow, collateral, collateral amount, "yes if collateral is ERC20 or no if collateral is ERC721 (an NFT)", and interest rate (which is the amount of interest you will pay to any user that funds your loan).
* Click on the "Approve" button to approve the loan transaction.
* Proceed to create the loan by clicking on the "Create Loan Request" button.
After creating the loan, you will be automatically navigated to the Lending section where you can monitor all your created/funded loans.

### Lending
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/Qmdho6SKao1R1vUiGu26Fk5aeQKyQMe4PkTmAUJeQxctor)
Lending on HederaFund is simpler than you might expect. Thanks to a smooth and intuitive user experience, users can easily carry out all lending activities. The platform features dedicated sections like "View All Loans", "Loans You Funded", and "Loans You Created" to help users effortlessly track their loan activities.
Search and pagination functionalities further enhance the usability of this powerful lending dApp.
To start lending, users can easily navigate and interact with the available action buttons provided within the dApp.
* Fund loan: This button is the button a user clicks on to fund a loan created by a borrower. No user can fund his own loan.
* Claim collateral: The claim collateral button is typically available for the lender to use in case a borrower fails to repay a loan during the specified duration in the loan. You can only claim collateral of a loan you funded.
* Withdraw loan: This button can be used by the borrower of a loan to withdraw the loan after it has been funded by a lender.
* Repay loan: This button is available to only the borrower of a loan such that before the end of the loan duration, the borrower uses it to repay the borrowed amount with interest.
* Withdraw collateral: In the event that there is no lender of a loan you created as a borrower, you can use this button to withdraw your collateral back. You can use this button only when your loan has not been funded.

### HederaFund Decentralized Chat System
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmcKMCjPeLAYgQ7weTzGb3aTXLVmaVueRQVB2HwfSps9vM)
For effective communication between borrowers and lenders, HederaFund provides a built-in decentralized chat system. Only the borrower and lender associated with a specific loan can communicate through this chat.
Please note: do not send funds directly to the lender or borrower. All transactions are securely managed by the dApp itself.

### HederaFund Token (HDF)
The HederaFund Token (HDF) is the native token of the HederaFund platform and is primarily used as collateral for lending activities.
In addition to HDF, users can also use other supported tokens like USDT and DAI as collateral.

## HederaFund Swap Feature
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmNaHE7mvrezc2dSmj8CWoe8ta38CQu6c4YacS6hfuHKG9)
HederaFund offers a seamless and secure token swap feature, to ensure accurate and reliable token swaps. This allows users to efficiently swap a variety of tokens directly within the platform.

Currently, users can swap the following tokens:

* HBAR (Hedera)

* HDF (HederaFund Token)

* USDT (Tether)

* DAI (Dai Stablecoin)


## Additional Notes (Future Upgrades for HederaFund)
In upcoming updates, HederaFund will introduce a host of new features and improvements to enhance the user experience and expand the platform's capabilities:

### Enhanced User Experience:
We remain committed to continuously improving the user experience, making the platform even more intuitive, responsive, and accessible.

### In-App Notifications:
Notifications will be integrated into the Lending dApp, allowing users to stay updated on loan status, payments, and other relevant activities in real time.

### File Sharing via IPFS and Filebase SDK:
For better communication and collaboration, file sharing through IPFS and the Filebase SDK through AWS will be integrated into the decentralized chat system, allowing users to exchange documents and data securely.

### More Supported Tokens and Collaterals:
We plan to expand the list of supported tokens and collateral options, providing more flexibility for both borrowers and lenders.

### Advanced Security Features:
Additional security measures will be implemented to further protect user assets and transactions, building on HederaFundâ€™s robust security architecture.

### Staking and Other Yield Farming Opportunities:
HederaFund aims to introduce staking and other yield farming features, allowing users to earn passive income by staking their tokens or providing liquidity to the platform.

### Cross-Chain Compatibility:
Weâ€™re exploring the integration of cross-chain capabilities, allowing users to interact with HederaFund using assets from other blockchain networks, enhancing accessibility and liquidity.

### Mobile App Development:
In the future, we plan to launch a mobile app, providing users with easy access to HederaFund's features and functionality on the go.

### Enhanced Analytics and Reporting Tools:
Lenders and borrowers will have access to detailed analytics and reporting tools, helping them track their activities, earnings, and overall performance on the platform.

### Liquidity Provider (LP) Rewards:
Liquidity providers in the HederaFund Swap will be rewarded with incentives. Users who supply liquidity to the swap pools (HBAR, HDF, USDT, DAI) will earn a share of the trading fees and possibly additional rewards in HDF tokens, encouraging a healthy liquidity environment.

## Developer (HederaFund)
* Patrick Ominisan - Blockchain developer


## Contract Addresses with Hedera Testnet Links [Hedera Testnet Explorer](https://hashscan.io/testnet)
![File](https://supposed-emerald-snake.myfilebase.com/ipfs/QmRHxHsBf3vf3DCftT3ErUuyiafksVZbm9beNKWdPY8BjR)

**All contracts are verified on the Hedera testnet explorer.**

### P2P Lending/Borrowing Contract

âœ… [P2PLending](https://hashscan.io/testnet/contract/0.0.6537847) ðŸŸ¢
- Address: `0xEB6e7F2772ec04D6E9cac673fc399EAa9e8F40b6`

### HederaFund ERC20 (HDF) Contract

âœ… [HederaFund Token](https://hashscan.io/testnet/contract/0.0.6521523) ðŸŸ¢
- Address: `0xB4e344aC158186B66B0ab62F880dbf63B6AFdA04`

### Swap Contract

âœ… [Swap](https://hashscan.io/testnet/contract/0.0.6538307) ðŸŸ¢
- Address: `0xA85C486c0e57267c954064Fd500077BDEdFa6704`

## Other Tokens

### USDT

- **[USDT](https://hashscan.io/testnet/contract/0.0.6522124)**: 0x5828810bed27a3174C594D5c6DC92DeC9A488876

### DAI

- **[DAI](https://hashscan.io/testnet/contract/0.0.6522217)**: 0x1e3a8726cF3B3536352FAeDF35b3201dE2a323dF





# P2PLending Smart Contract Technical Documentation

## Overview

The `P2PLending` smart contract facilitates **peer-to-peer lending** using:
- **HBAR** (native Hedera currency)  
- **ERC20 tokens**  as collateral
- **ERC721 NFTs** as collateral  

It supports:
- Loan creation, funding, repayment  
- Collateral claiming on default  
- Loan cancellation/withdrawal  
- Service charge collection by the contract owner  

Security features include:
- `ReentrancyGuard` to prevent re-entrancy attacks  
- Strict access control via modifiers  
- Collateral whitelist  

---

## Constructor

### Initialization

Initializes the contract by setting:
- **Owner address**
- **Accepted collateral tokens** (HDF, USDT, DAI)

```solidity
constructor(address _initialOwner, address _hdf, address _usdt, address _dai) {
    require(_initialOwner != address(0), "Invalid owner address");
    _owner = _initialOwner;
    _addCollateral(_hdf);
    _addCollateral(_usdt);
    _addCollateral(_dai);
}
```

**Logic:**
- Validates non-zero owner address  
- Sets `_owner`  
- Adds initial accepted collaterals to whitelist  

---

## Data Structures

### Loan Struct

```solidity
struct Loan {
    uint loan_id;
    uint amount;
    uint interest;
    uint duration;
    uint repaymentAmount;
    uint fundingDeadline;
    uint collateralAmount;
    address borrower;
    address payable lender;
    address collateral;
    bool isCollateralErc20;
    bool active;
    bool repaid;
}
```

**Fields:**
- `loan_id`: Unique identifier  
- `amount`: Loan amount in tinybars or token units  
- `interest`: Interest rate percentage  
- `duration`: Expiration timestamp  
- `repaymentAmount`: Principal + interest  
- `fundingDeadline`: Deadline for loan funding  
- `collateralAmount`: ERC20 amount or ERC721 token ID  
- `borrower`: Address of borrower  
- `lender`: Address of lender (payable)  
- `collateral`: Token/NFT contract address  
- `isCollateralErc20`: True for ERC20 collateral  
- `active`: Loan status flag  
- `repaid`: Repayment flag  

### Mappings

- `loans`: Maps loan ID â†’ Loan struct  
- `defaulters`: Tracks number of defaults per borrower  
- `outstanding`: Tracks if borrower has an active loan  
- `acceptedCollaterals`: Whitelist of allowed collateral addresses  
- `acceptedCollateralsList`: Array of accepted collateral addresses  

---

## Modifiers

- **`onlyOwner`** â€“ Restricts function access to contract owner  
- **`onlyActiveLoan(uint)`** â€“ Ensures loan is still active  
- **`isCollateral(address)`** â€“ Ensures collateral is whitelisted  
- **`onlyDao(address)`** â€“ Restricts DAO-only functions  
- **`onlyBorrower(uint)`** â€“ Restricts access to the borrower of a loan  

---

## Functions

### owner
Returns the current owner address.

```solidity
function owner() public view returns (address)
```

### transferOwnership
Transfers contract ownership.

```solidity
function transferOwnership(address newOwner) external onlyOwner
```
- Requires new owner is not zero address.  

### setDaoAddress
Sets the DAO address.

```solidity
function setDaoAddress(address _dao) external onlyOwner
```
- Requires non-zero DAO address.  

### addCollateral
Adds a new collateral token to the whitelist.

```solidity
function addCollateral(address _collateral) external onlyOwner
```
- Requires non-zero collateral address.  
- Emits `CollateralAdded`.  

### getAllLoans
Returns all loans stored in the contract.

```solidity
function getAllLoans() external view returns (Loan[] memory)
```

### createLoan
Creates a new loan request.

```solidity
function createLoan(
    uint _amount,
    uint _interest,
    uint _duration,
    uint _collateralAmount,
    address _collateral,
    bool _isERC20,
    uint _fundingDeadline
) external payable
```

**Key Points:**
- Validates amount, interest, duration, funding deadline.  
- HBAR loans require correct `msg.value`.  
- ERC20 loans must send no HBAR.  
- Collateral is transferred to the contract.  
- Emits `LoanCreated`.  

### fundLoan
Funds an active loan.

```solidity
function fundLoan(uint _loanId) external payable
```

- Cannot be borrower.  
- Must be before funding deadline.  
- Transfers funds to borrower.  
- Emits `LoanFunded`.  

### repayLoan
Repays an active loan.

```solidity
function repayLoan(uint _loanId) external payable
```

- Only borrower can repay.  
- Calculates and deducts service fee.  
- Sends repayment (minus fee) to lender.  
- Returns collateral to borrower.  
- Emits `LoanRepaid` and `ServiceFeeDeducted`.  

### getLoanInfo
Returns a single loanâ€™s details.

```solidity
function getLoanInfo(uint _loanId) external view
```

### claimCollateral
Claims collateral when borrower defaults.

```solidity
function claimCollateral(uint _loanId) external
```

- Only lender can claim.  
- Loan must be overdue and unpaid.  
- Transfers collateral to lender.  
- Emits `CollateralClaimed`.  

### withdrawFunds
Withdraws collateral for unfunded loans.

```solidity
function withdrawFunds(uint _loanId) external
```

- Only borrower can call.  
- Loan must not be funded.  
- Returns collateral to borrower.  
- Emits `CollateralWithdrawn`.  

### withdrawServiceCharges
Owner withdraws accumulated service charges.

```solidity
function withdrawServiceCharges() external onlyOwner
```
- Resets `totalServiceCharges` to zero.  
- Emits `ServiceChargesWithdrawn`.  

### cancelLoan
Cancels a pending loan request.

```solidity
function cancelLoan(uint _loanId) external
```

- Only borrower can call.  
- Loan must be unfunded and within deadline.  
- Returns collateral to borrower.  
- Emits `LoanCancelled`.  

### getLoanStatus
Returns human-readable loan status.

```solidity
function getLoanStatus(uint _loanId) external view returns (string memory)
```

Possible values:  
- `"Repaid"`  
- `"Cancelled or Withdrawn"`  
- `"Inactive"`  
- `"Defaulted"`  
- `"Funded"`  
- `"Expired"`  
- `"Pending"`  

### getBorrowerLoans
Fetches all loans for a given borrower.

```solidity
function getBorrowerLoans(address _borrower) external view returns (Loan[] memory)
```

---

## Loan Lifecycle Flow

1. **Borrower Creates Loan** (`createLoan`)  
   - Specifies amount, interest, collateral, deadline  
   - Transfers collateral to contract  

2. **Lender Funds Loan** (`fundLoan`)  
   - Sends funds to borrower  

3. **Borrower Repays Loan** (`repayLoan`)  
   - Sends repayment to lender (minus service fee)  
   - Collateral returned to borrower  

4. **Default Handling** (`claimCollateral`)  
   - If loan expires unpaid, lender claims collateral  

5. **Cancellation / Withdrawal**  
   - Borrower cancels loan (`cancelLoan`) or withdraws collateral if unfunded (`withdrawFunds`)  

---

## receive & fallback

The contract includes:
- `receive()` â€“ Accepts direct HBAR transfers  
- `fallback()` â€“ Handles unexpected calls  


## Security Considerations
- **Reentrancy Protection:** `nonReentrant` modifier prevents reentrancy attacks.
- **Slippage Tolerance:** Ensures users receive at least 98% of the expected amount.
- **Chainlink Oracles:** Provides reliable price feeds (though token prices are used in this version).
- **Ownable:** Restricts token addition to the contract owner.
- **Liquidity Checks:** Prevents swaps with insufficient liquidity.

